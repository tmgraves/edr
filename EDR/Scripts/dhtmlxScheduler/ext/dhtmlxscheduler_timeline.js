/*
 dhtmlxScheduler.Net v.3.2.0 Professional Evaluation

This software is covered by DHTMLX Evaluation License. Contact sales@dhtmlx.com to get Commercial or Enterprise license. Usage without proper license is prohibited.

(c) Dinamenta, UAB.
*/
Scheduler.plugin(function(e){e._temp_matrix_scope=function(){function t(){for(var t=e.get_visible_events(),a=[],n=0;n<this.y_unit.length;n++)a[n]=[];a[i]||(a[i]=[]);for(var n=0;n<t.length;n++){for(var i=this.order[t[n][this.y_property]],r=0;this._trace_x[r+1]&&t[n].start_date>=this._trace_x[r+1];)r++;for(;this._trace_x[r]&&t[n].end_date>this._trace_x[r];)a[i][r]||(a[i][r]=[]),a[i][r].push(t[n]),r++}return a}function a(t,a,n){var i=0,r=n._step,s=n.round_position,d=0,o=a?t.end_date:t.start_date;o.valueOf()>e._max_date.valueOf()&&(o=e._max_date);
var _=o-e._min_date_timeline;if(_>0){var l=e._get_date_index(n,o);e._ignores[l]&&(s=!0);for(var c=0;l>c;c++)i+=e._cols[c];var h=e.date.add(e._min_date_timeline,e.matrix[e._mode].x_step*l,e.matrix[e._mode].x_unit);s?+o>+h&&a&&(d=e._cols[l]):(_=o-h,n.first_hour||n.last_hour?(_-=n._start_correction,0>_&&(_=0),d=Math.round(_/r),d>e._cols[l]&&(d=e._cols[l])):d=Math.round(_/r))}return i+=a?0===_||s?d-14:d-12:d+1}function n(t,a){var n=e._get_date_index(this,t),i=this._trace_x[n];return a&&+t!=+this._trace_x[n]&&(i=this._trace_x[n+1]?this._trace_x[n+1]:e.date.add(this._trace_x[n],this.x_step,this.x_unit)),new Date(i)
}function i(t){var a="";if(t&&"cell"!=this.render){t.sort(this.sort||function(e,t){return e.start_date.valueOf()==t.start_date.valueOf()?e.id>t.id?1:-1:e.start_date>t.start_date?1:-1});for(var i=[],r=t.length,s=0;r>s;s++){var d=t[s];d._inner=!1;var o=this.round_position?n.apply(this,[d.start_date,!1]):d.start_date;for(this.round_position?n.apply(this,[d.end_date,!0]):d.end_date;i.length;){var _=i[i.length-1];if(!(_.end_date.valueOf()<=o.valueOf()))break;i.splice(i.length-1,1)}for(var l=!1,c=0;c<i.length;c++){var h=i[c];
if(h.end_date.valueOf()<=o.valueOf()){l=!0,d._sorder=h._sorder,i.splice(c,1),d._inner=!0;break}}if(i.length&&(i[i.length-1]._inner=!0),!l)if(i.length)if(i.length<=i[i.length-1]._sorder){if(i[i.length-1]._sorder)for(var u=0;u<i.length;u++){for(var v=!1,f=0;f<i.length;f++)if(i[f]._sorder==u){v=!0;break}if(!v){d._sorder=u;break}}else d._sorder=0;d._inner=!0}else{for(var g=i[0]._sorder,p=1;p<i.length;p++)i[p]._sorder>g&&(g=i[p]._sorder);d._sorder=g+1,d._inner=!1}else d._sorder=0;i.push(d),i.length>(i.max_count||0)?(i.max_count=i.length,d._count=i.length):d._count=d._count?d._count:1
}for(var m=0;m<t.length;m++)t[m]._count=i.max_count;for(var x=0;r>x;x++)a+=e.render_timeline_event.call(this,t[x],!1)}return a}function r(a){var n="<table style='table-layout:fixed;' cellspacing='0' cellpadding='0'>",r=[];if(e._load_mode&&e._load(),"cell"==this.render)r=t.call(this);else for(var s=e.get_visible_events(),d=this.order,o=0;o<s.length;o++){var _=s[o],l=_[this.y_property],c=this.order[l];if(this.show_unassigned&&!l){for(var h in d)if(d.hasOwnProperty(h)){c=d[h],r[c]||(r[c]=[]);var u=e._lame_copy({},_);
u[this.y_property]=h,r[c].push(u)}}else r[c]||(r[c]=[]),r[c].push(_)}for(var v=0,f=0;f<e._cols.length;f++)v+=e._cols[f];var g=new Date,p=e._cols.length-e._ignores_detected;g=(e.date.add(g,this.x_step*p,this.x_unit)-g-(this._start_correction+this._end_correction)*p)/v,this._step=g,this._summ=v;var m=e._colsS.heights=[],x=[];this._events_height={},this._section_height={};for(var f=0;f<this.y_unit.length;f++){var y=this._logic(this.render,this.y_unit[f],this);e._merge(y,{height:this.dy}),this.section_autoheight&&(this.y_unit.length*y.height<a.offsetHeight&&(y.height=Math.max(y.height,Math.floor((a.offsetHeight-1)/this.y_unit.length))),this._section_height[this.y_unit[f].key]=y.height),y.td_className||(y.td_className="dhx_matrix_scell"+(e.templates[this.name+"_scaley_class"](this.y_unit[f].key,this.y_unit[f].label,this.y_unit[f])?" "+e.templates[this.name+"_scaley_class"](this.y_unit[f].key,this.y_unit[f].label,this.y_unit[f]):"")),y.td_content||(y.td_content=e.templates[this.name+"_scale_label"](this.y_unit[f].key,this.y_unit[f].label,this.y_unit[f])),e._merge(y,{tr_className:"",style_height:"height:"+y.height+"px;",style_width:"width:"+(this.dx-1)+"px;",summ_width:"width:"+v+"px;",table_className:""});
var b=i.call(this,r[f]);if(this.fit_events){var w=this._events_height[this.y_unit[f].key]||0;y.height=w>y.height?w:y.height,y.style_height="height:"+y.height+"px;",this._section_height[this.y_unit[f].key]=y.height}if(n+="<tr class='"+y.tr_className+"' style='"+y.style_height+"'><td class='"+y.td_className+"' style='"+y.style_width+" height:"+(y.height-1)+"px;'>"+y.td_content+"</td>","cell"==this.render)for(var o=0;o<e._cols.length;o++)n+=e._ignores[o]?"<td></td>":"<td class='dhx_matrix_cell "+e.templates[this.name+"_cell_class"](r[f][o],this._trace_x[o],this.y_unit[f])+"' style='width:"+(e._cols[o]-1)+"px'><div style='width:"+(e._cols[o]-1)+"px'>"+e.templates[this.name+"_cell_value"](r[f][o],this._trace_x[o],this.y_unit[f])+"</div></td>";
else{n+="<td><div style='"+y.summ_width+" "+y.style_height+" position:relative;' class='dhx_matrix_line'>",n+=b,n+="<table class='"+y.table_className+"' cellpadding='0' cellspacing='0' style='"+y.summ_width+" "+y.style_height+"' >";for(var o=0;o<e._cols.length;o++)n+=e._ignores[o]?"<td></td>":"<td class='dhx_matrix_cell "+e.templates[this.name+"_cell_class"](r[f],this._trace_x[o],this.y_unit[f])+"' style='width:"+(e._cols[o]-1)+"px'><div style='width:"+(e._cols[o]-1)+"px'></div></td>";n+="</table>",n+="</div></td>"
}n+="</tr>",x.push(y)}n+="</table>",this._matrix=r,a.innerHTML=n,e._rendered=[];for(var k=e._obj.getElementsByTagName("DIV"),f=0;f<k.length;f++)k[f].getAttribute("event_id")&&e._rendered.push(k[f]);this._scales={};for(var E=a.firstChild.rows,D=null,f=0,N=x.length;N>f;f++){D=this.y_unit[f],m.push(x[f].height);var M=D.key,C=this._scales[M]=e._isRender("cell")?E[f]:E[f].childNodes[1].getElementsByTagName("div")[0];e.callEvent("onScaleAdd",[C,M])}}function s(t){var a=e.xy.scale_height,n=this._header_resized||e.xy.scale_height;
e._cols=[],e._colsS={height:0},this._trace_x=[];var i=e._x-this.dx-e.xy.scroll_width,r=[this.dx],s=e._els.dhx_cal_header[0];s.style.width=r[0]+i+"px",e._min_date_timeline=e._min_date;var o=e.config.preserve_scale_length,_=e._min_date;e._process_ignores(_,this.x_size,this.x_unit,this.x_step,o);var l=this.x_size+(o?e._ignores_detected:0);l!=this.x_size&&(e._max_date=e.date.add(e._min_date,l*this.x_step,this.x_unit));for(var c=l-e._ignores_detected,u=0;l>u;u++)this._trace_x[u]=new Date(_),_=e.date.add(_,this.x_step,this.x_unit),e._ignores[u]?(e._cols[u]=0,c++):e._cols[u]=Math.floor(i/(c-u)),i-=e._cols[u],r[u+1]=r[u]+e._cols[u];
if(t.innerHTML="<div></div>",this.second_scale){for(var v=this.second_scale.x_unit,f=[this._trace_x[0]],g=[],p=[this.dx,this.dx],m=0,x=0;x<this._trace_x.length;x++){var y=this._trace_x[x],b=d(v,y,f[m]);b&&(++m,f[m]=y,p[m+1]=p[m]);var w=m+1;g[m]=e._cols[x]+(g[m]||0),p[w]+=e._cols[x]}t.innerHTML="<div></div><div></div>";var k=t.firstChild;k.style.height=n+"px";var E=t.lastChild;E.style.position="relative";for(var D=0;D<f.length;D++){var N=f[D],M=e.templates[this.name+"_second_scalex_class"](N),C=document.createElement("DIV");
C.className="dhx_scale_bar dhx_second_scale_bar"+(M?" "+M:""),e.set_xy(C,g[D]-1,n-3,p[D],0),C.innerHTML=e.templates[this.name+"_second_scale_date"](N),k.appendChild(C)}}e.xy.scale_height=n,t=t.lastChild;for(var L=0;L<this._trace_x.length;L++)if(!e._ignores[L]){_=this._trace_x[L],e._render_x_header(L,r[L],_,t);var O=e.templates[this.name+"_scalex_class"](_);O&&(t.lastChild.className+=" "+O)}e.xy.scale_height=a;var T=this._trace_x;t.onclick=function(t){var a=h(t);a&&e.callEvent("onXScaleClick",[a.x,T[a.x],t||event])
},t.ondblclick=function(t){var a=h(t);a&&e.callEvent("onXScaleDblClick",[a.x,T[a.x],t||event])}}function d(t,a,n){switch(t){case"hour":return a.getHours()!=n.getHours()||d("day",a,n);case"day":return!(a.getDate()==n.getDate()&&a.getMonth()==n.getMonth()&&a.getFullYear()==n.getFullYear());case"week":return!(e.date.getISOWeek(a)==e.date.getISOWeek(n)&&a.getFullYear()==n.getFullYear());case"month":return!(a.getMonth()==n.getMonth()&&a.getFullYear()==n.getFullYear());case"year":return!(a.getFullYear()==n.getFullYear());
default:return!1}}function o(t){if(t){e.set_sizes(),e._init_matrix_tooltip();var a=e._min_date;s.call(this,e._els.dhx_cal_header[0]),r.call(this,e._els.dhx_cal_data[0]),e._min_date=a,e._els.dhx_cal_date[0].innerHTML=e.templates[this.name+"_date"](e._min_date,e._max_date),e._mark_now&&e._mark_now()}_()}function _(){e._tooltip&&(e._tooltip.style.display="none",e._tooltip.date="")}function l(t,a,n){if("cell"==t.render){var i=a.x+"_"+a.y,r=t._matrix[a.y][a.x];if(!r)return _();if(r.sort(function(e,t){return e.start_date>t.start_date?1:-1
}),e._tooltip){if(e._tooltip.date==i)return;e._tooltip.innerHTML=""}else{var s=e._tooltip=document.createElement("DIV");s.className="dhx_year_tooltip",document.body.appendChild(s),s.onclick=e._click.dhx_cal_data}for(var d="",o=0;o<r.length;o++){var l=r[o].color?"background-color:"+r[o].color+";":"",c=r[o].textColor?"color:"+r[o].textColor+";":"";d+="<div class='dhx_tooltip_line' event_id='"+r[o].id+"' style='"+l+c+"'>",d+="<div class='dhx_tooltip_date'>"+(r[o]._timed?e.templates.event_date(r[o].start_date):"")+"</div>",d+="<div class='dhx_event_icon icon_details'>&nbsp;</div>",d+=e.templates[t.name+"_tooltip"](r[o].start_date,r[o].end_date,r[o])+"</div>"
}e._tooltip.style.display="",e._tooltip.style.top="0px",e._tooltip.style.left=document.body.offsetWidth-n.left-e._tooltip.offsetWidth<0?n.left-e._tooltip.offsetWidth+"px":n.left+a.src.offsetWidth+"px",e._tooltip.date=i,e._tooltip.innerHTML=d,e._tooltip.style.top=document.body.offsetHeight-n.top-e._tooltip.offsetHeight<0?n.top-e._tooltip.offsetHeight+a.src.offsetHeight+"px":n.top+"px"}}function c(e){for(var t=e.parentNode.childNodes,a=0;a<t.length;a++)if(t[a]==e)return a;return-1}function h(e){e=e||event;
for(var t=e.target?e.target:e.srcElement;t&&"DIV"!=t.tagName;)t=t.parentNode;if(t&&"DIV"==t.tagName){var a=t.className.split(" ")[0];if("dhx_scale_bar"==a)return{x:c(t),y:-1,src:t,scale:!0}}}e.matrix={},e._merge=function(e,t){for(var a in t)"undefined"==typeof e[a]&&(e[a]=t[a])},e.createTimelineView=function(t){e._skin_init(),e._merge(t,{section_autoheight:!0,name:"matrix",x:"time",y:"time",x_step:1,x_unit:"hour",y_unit:"day",y_step:1,x_start:0,x_size:24,y_start:0,y_size:7,render:"cell",dx:200,dy:50,event_dy:e.xy.bar_height-5,event_min_dy:e.xy.bar_height-5,resize_events:!0,fit_events:!0,show_unassigned:!1,second_scale:!1,round_position:!1,_logic:function(t,a,n){var i={};
return e.checkEvent("onBeforeSectionRender")&&(i=e.callEvent("onBeforeSectionRender",[t,a,n])),i}}),t._original_x_start=t.x_start,"day"!=t.x_unit&&(t.first_hour=t.last_hour=0),t._start_correction=t.first_hour?60*t.first_hour*60*1e3:0,t._end_correction=t.last_hour?60*(24-t.last_hour)*60*1e3:0,e.checkEvent("onTimelineCreated")&&e.callEvent("onTimelineCreated",[t]);var a=e.render_data;e.render_data=function(n,i){if(this._mode!=t.name)return a.apply(this,arguments);if(i&&!t.show_unassigned&&"cell"!=t.render)for(var r=0;r<n.length;r++)this.clear_event(n[r]),this.render_timeline_event.call(this.matrix[this._mode],n[r],!0);
else e._renderMatrix.call(t,!0,!0)},e.matrix[t.name]=t,e.templates[t.name+"_cell_value"]=function(e){return e?e.length:""},e.templates[t.name+"_cell_class"]=function(){return""},e.templates[t.name+"_scalex_class"]=function(){return""},e.templates[t.name+"_second_scalex_class"]=function(){return""},e.templates[t.name+"_scaley_class"]=function(){return""},e.templates[t.name+"_scale_label"]=function(e,t){return t},e.templates[t.name+"_tooltip"]=function(e,t,a){return a.text},e.templates[t.name+"_date"]=function(t,a){return t.getDay()==a.getDay()&&864e5>a-t||+t==+e.date.date_part(new Date(a))||+e.date.add(t,1,"day")==+a&&0===a.getHours()&&0===a.getMinutes()?e.templates.day_date(t):t.getDay()!=a.getDay()&&864e5>a-t?e.templates.day_date(t)+" &ndash; "+e.templates.day_date(a):e.templates.week_date(t,a)
},e.templates[t.name+"_scale_date"]=e.date.date_to_str(t.x_date||e.config.hour_date),e.templates[t.name+"_second_scale_date"]=e.date.date_to_str(t.second_scale&&t.second_scale.x_date?t.second_scale.x_date:e.config.hour_date),e.date["add_"+t.name]=function(a,n){var i=e.date.add(a,(t.x_length||t.x_size)*n*t.x_step,t.x_unit);if("minute"==t.x_unit||"hour"==t.x_unit){var r=t.x_length||t.x_size,s="hour"==t.x_unit?60*t.x_step:t.x_step;if(s*r%1440)if(+e.date.date_part(new Date(a))==+e.date.date_part(new Date(i)))t.x_start+=n*r;
else{var d=1440/(r*s)-1,o=Math.round(d*r);t.x_start=n>0?t.x_start-o:o+t.x_start}}return i},e.date[t.name+"_start"]=function(a){var n=e.date[t.x_unit+"_start"]||e.date.day_start,i=n.call(e.date,a);return i=e.date.add(i,t.x_step*t.x_start,t.x_unit)},e.callEvent("onOptionsLoad",[t]),e[t.name+"_view"]=function(a){a?e._table_view=!0:e._renderMatrix.apply(t,arguments)};{var i=new Date;e.date.add(i,t.x_step,t.x_unit).valueOf()-i.valueOf()}e["mouse_"+t.name]=function(a){var i=this._drag_event;this._drag_id&&(i=this.getEvent(this._drag_id),this._drag_event._dhx_changed=!0),a.x-=t.dx;
var r,s,d=0,o=0;for(o;o<=this._cols.length-1;o++)if(s=this._cols[o],d+=s,d>a.x){r=(a.x-(d-s))/s,r=0>r?0:r;break}if(t.round_position){var _=1;e.getState().drag_mode&&"move"!=e.getState().drag_mode&&(_=.5),r>=_&&o++,r=0}if(0===o&&this._ignores[0])for(o=1,r=0;this._ignores[o];)o++;else if(o==this._cols.length&&this._ignores[o-1]){for(o=this._cols.length-1,r=0;this._ignores[o];)o--;o++}a.x=0,a.force_redraw=!0,a.custom=!0;var l;if(o>=t._trace_x.length)l=e.date.add(t._trace_x[t._trace_x.length-1],t.x_step,t.x_unit),t._end_correction&&(l=new Date(l-t._end_correction));
else{var c=r*s*t._step+t._start_correction;l=new Date(+t._trace_x[o]+c)}if("move"==this._drag_mode&&this._drag_id&&this._drag_event){var i=this.getEvent(this._drag_id),h=this._drag_event;if(a._ignores=this._ignores_detected||t._start_correction||t._end_correction,h._move_delta||(h._move_delta=(i.start_date-l)/6e4,this.config.preserve_length&&a._ignores&&(h._move_delta=this._get_real_event_length(i.start_date,l,t),h._event_length=this._get_real_event_length(i.start_date,i.end_date,t))),this.config.preserve_length&&a._ignores){var u=(h._event_length,this._get_fictional_event_length(l,h._move_delta,t,!0));
l=new Date(l-u)}else l=e.date.add(l,h._move_delta,"minute")}if("resize"==this._drag_mode&&i&&(this._drag_from_start&&+l>+i.end_date?this._drag_from_start=!1:!this._drag_from_start&&+l<+i.start_date&&(this._drag_from_start=!0),a.resize_from_start=this._drag_from_start),t.round_position)switch(this._drag_mode){case"move":this.config.preserve_length||(l=n.call(t,l,!1),"day"==t.x_unit&&(a.custom=!1));break;case"resize":this._drag_event&&((null===this._drag_event._resize_from_start||void 0===this._drag_event._resize_from_start)&&(this._drag_event._resize_from_start=a.resize_from_start),a.resize_from_start=this._drag_event._resize_from_start,l=n.call(t,l,!this._drag_event._resize_from_start))
}return this._resolve_timeline_section(t,a),a.section&&this._update_timeline_section({pos:a,event:this.getEvent(this._drag_id),view:t}),a.y=Math.round((l-this._min_date)/(6e4*this.config.time_step)),a.shift=this.config.time_step,a}},e._get_timeline_event_height=function(e,t){var a=e[t.y_property],n=t.event_dy;return"full"==t.event_dy&&(n=t.section_autoheight?t._section_height[a]-6:t.dy-3),t.resize_events&&(n=Math.max(Math.floor(n/e._count),t.event_min_dy)),n},e._get_timeline_event_y=function(t,a){var n=t,i=2+n*a+(n?2*n:0);
return e.config.cascade_event_display&&(i=2+n*e.config.cascade_event_margin+(n?2*n:0)),i},e.render_timeline_event=function(t,n){var i=t[this.y_property];if(!i)return"";var r=t._sorder,s=a(t,!1,this),d=a(t,!0,this),o=e._get_timeline_event_height(t,this),_=o-2;t._inner||"full"!=this.event_dy||(_=(_+2)*(t._count-r)-2);var l=e._get_timeline_event_y(t._sorder,o),c=o+l+2;(!this._events_height[i]||this._events_height[i]<c)&&(this._events_height[i]=c);var h=e.templates.event_class(t.start_date,t.end_date,t);
h="dhx_cal_event_line "+(h||"");var u=t.color?"background:"+t.color+";":"",v=t.textColor?"color:"+t.textColor+";":"",f=e.templates.event_bar_text(t.start_date,t.end_date,t),g='<div event_id="'+t.id+'" class="'+h+'" style="'+u+v+"position:absolute; top:"+l+"px; height: "+_+"px; left:"+s+"px; width:"+Math.max(0,d-s)+"px;"+(t._text_style||"")+'">';if(e.config.drag_resize&&!e.config.readonly){var p="dhx_event_resize";g+="<div class='"+p+" "+p+"_start' style='height: "+_+"px;'></div><div class='"+p+" "+p+"_end' style='height: "+_+"px;'></div>"
}if(g+=f+"</div>",!n)return g;var m=document.createElement("DIV");m.innerHTML=g;var x=this.order[i],y=e._els.dhx_cal_data[0].firstChild.rows[x].cells[1].firstChild;e._rendered.push(m.firstChild),y.appendChild(m.firstChild)},e._matrix_tooltip_handler=function(t){var a=e.matrix[e._mode];if(a&&"cell"==a.render){if(a){{var n=e._locate_cell_timeline(t),t=t||event;t.target||t.srcElement}if(n)return l(a,n,getOffset(n.src))}_()}},e._init_matrix_tooltip=function(){e._detachDomEvent(e._els.dhx_cal_data[0],"mouseover",e._matrix_tooltip_handler),dhtmlxEvent(e._els.dhx_cal_data[0],"mouseover",e._matrix_tooltip_handler)
},e._renderMatrix=function(t,a){if(a||(e._els.dhx_cal_data[0].scrollTop=0),e._min_date=e.date[this.name+"_start"](e._date),e._max_date=e.date.add(e._min_date,this.x_size*this.x_step,this.x_unit),e._table_view=!0,this.second_scale&&(t&&!this._header_resized&&(this._header_resized=e.xy.scale_height,e.xy.scale_height*=2,e._els.dhx_cal_header[0].className+=" dhx_second_cal_header"),!t&&this._header_resized)){e.xy.scale_height/=2,this._header_resized=!1;var n=e._els.dhx_cal_header[0];n.className=n.className.replace(/ dhx_second_cal_header/gi,"")
}o.call(this,t)},e._locate_cell_timeline=function(t){t=t||event;for(var a=t.target?t.target:t.srcElement,n={},i=e.matrix[e._mode],r=e.getActionData(t),s=0;s<i._trace_x.length-1&&!(+r.date<i._trace_x[s+1]);s++);n.x=s,n.y=i.order[r.section];var d=e._isRender("cell")?1:0;n.src=i._scales[r.section]?i._scales[r.section].getElementsByTagName("td")[s+d]:null;for(var o=!1;0===n.x&&"dhx_cal_data"!=a.className&&a.parentNode;){if("dhx_matrix_scell"==a.className.split(" ")[0]){o=!0;break}a=a.parentNode}return o&&(n.x=-1,n.src=a,n.scale=!0),n
};var u=e._click.dhx_cal_data;e._click.dhx_marked_timespan=e._click.dhx_cal_data=function(t){var a=u.apply(this,arguments),n=e.matrix[e._mode];if(n){var i=e._locate_cell_timeline(t);i&&(i.scale?e.callEvent("onYScaleClick",[i.y,n.y_unit[i.y],t||event]):e.callEvent("onCellClick",[i.x,i.y,n._trace_x[i.x],(n._matrix[i.y]||{})[i.x]||[],t||event]))}return a},e.dblclick_dhx_matrix_cell=function(t){var a=e.matrix[e._mode];if(a){var n=e._locate_cell_timeline(t);n&&(n.scale?e.callEvent("onYScaleDblClick",[n.y,a.y_unit[n.y],t||event]):e.callEvent("onCellDblClick",[n.x,n.y,a._trace_x[n.x],(a._matrix[n.y]||{})[n.x]||[],t||event]))
}};var v=e.dblclick_dhx_marked_timespan||function(){};e.dblclick_dhx_marked_timespan=function(t){var a=e.matrix[e._mode];return a?e.dblclick_dhx_matrix_cell(t):v.apply(this,arguments)},e.dblclick_dhx_matrix_scell=function(t){return e.dblclick_dhx_matrix_cell(t)},e._isRender=function(t){return e.matrix[e._mode]&&e.matrix[e._mode].render==t},e.attachEvent("onCellDblClick",function(t,a,n,i,r){if(!this.config.readonly&&("dblclick"!=r.type||this.config.dblclick_create)){var s=e.matrix[e._mode],d={};d.start_date=s._trace_x[t],d.end_date=s._trace_x[t+1]?s._trace_x[t+1]:e.date.add(s._trace_x[t],s.x_step,s.x_unit),s._start_correction&&(d.start_date=new Date(1*d.start_date+s._start_correction)),s._end_correction&&(d.end_date=new Date(d.end_date-s._end_correction)),d[s.y_property]=s.y_unit[a].key,e.addEventNow(d,null,r)
}}),e.attachEvent("onBeforeDrag",function(){return!e._isRender("cell")}),e.attachEvent("onEventChanged",function(e,t){t._timed=this.isOneDayEvent(t)}),e._is_column_visible=function(t){var a=e.matrix[e._mode],n=e._get_date_index(a,t);return!e._ignores[n]};var f=e._render_marked_timespan;e._render_marked_timespan=function(t,n,i,r,s){if(!e.config.display_marked_timespans)return[];if(e.matrix&&e.matrix[e._mode]){if(e._isRender("cell"))return;var d=e._lame_copy({},e.matrix[e._mode]);d.round_position=!1;
var o=[],_=[],l=[],c=t.sections?t.sections.units||t.sections.timeline:null;if(i)l=[n],_=[i];else{var h=d.order;if(c)h.hasOwnProperty(c)&&(_.push(c),l.push(d._scales[c]));else for(var u in h)h.hasOwnProperty(u)&&(_.push(u),l.push(d._scales[u]))}var r=r?new Date(r):e._min_date,s=s?new Date(s):e._max_date;if(r.valueOf()<e._min_date.valueOf()&&(r=new Date(e._min_date)),s.valueOf()>e._max_date.valueOf()&&(s=new Date(e._max_date)),!e._is_column_visible(r))return;var v=[];if(t.days>6){var g=new Date(t.days);
e.date.date_part(new Date(r))<=+g&&+s>=+g&&v.push(g)}else v.push.apply(v,e._get_dates_by_index(t.days));for(var p=t.zones,m=e._get_css_classes_by_config(t),x=0;x<_.length;x++){n=l[x],i=_[x];for(var y=0;y<v.length;y++)for(var b=v[y],w=0;w<p.length;w+=2){var k=p[w],E=p[w+1],D=new Date(+b+60*k*1e3),N=new Date(+b+60*E*1e3);if(N>r&&s>D){var M=e._get_block_by_config(t);M.className=m;var C=a({start_date:D},!1,d)-1,L=a({start_date:N},!1,d)-1,O=Math.max(1,L-C-1),T=d._section_height[i]-1;M.style.cssText="height: "+T+"px; left: "+C+"px; width: "+O+"px; top: 0;",n.insertBefore(M,n.firstChild),o.push(M)
}}}return o}return f.apply(e,[t,n,i])};var g=e._append_mark_now;e._append_mark_now=function(t,a){if(e.matrix&&e.matrix[e._mode]){var n=e._currentDate(),i=e._get_zone_minutes(n),r={days:+e.date.date_part(n),zones:[i,i+1],css:"dhx_matrix_now_time",type:"dhx_now_time"};return e._render_marked_timespan(r)}return g.apply(e,[t,a])},e.attachEvent("onScaleAdd",function(t,a){var n=e._marked_timespans;if(n&&e.matrix&&e.matrix[e._mode])for(var i=e._mode,r=e._min_date,s=e._max_date,d=n.global,o=e.date.date_part(new Date(r));s>o;o=e.date.add(o,1,"day")){var _=+o,l=o.getDay(),c=[],h=d[_]||d[l];
if(c.push.apply(c,e._get_configs_to_render(h)),n[i]&&n[i][a]){var u=[],v=e._get_types_to_render(n[i][a][l],n[i][a][_]);u.push.apply(u,e._get_configs_to_render(v)),u.length&&(c=u)}for(var f=0;f<c.length;f++){var g=c[f],p=g.days;7>p?(p=_,e._render_marked_timespan(g,t,a,o,e.date.add(o,1,"day")),p=l):e._render_marked_timespan(g,t,a,o,e.date.add(o,1,"day"))}}}),e._resolve_timeline_section=function(e,t){var a=0,n=0;for(a;a<this._colsS.heights.length&&(n+=this._colsS.heights[a],!(n>t.y));a++);e.y_unit[a]||(a=e.y_unit.length-1),this._drag_event&&!this._drag_event._orig_section&&(this._drag_event._orig_section=e.y_unit[a].key),t.fields={},a>=0&&e.y_unit[a]&&(t.section=t.fields[e.y_property]=e.y_unit[a].key)
},e._update_timeline_section=function(e){var t=e.view,a=e.event,n=e.pos;if(a){if(a[t.y_property]!=n.section){var i=this._get_timeline_event_height(a,t);a._sorder=this._get_dnd_order(a._sorder,i,t._section_height[n.section])}a[t.y_property]=n.section}},e._get_date_index=function(e,t){for(var a=0,n=e._trace_x;a<n.length-1&&+t>=+n[a+1];)a++;return a},e.attachEvent("onBeforeTodayDisplayed",function(){for(var t in e.matrix){var a=e.matrix[t];a.x_start=a._original_x_start}return!0}),e.attachEvent("onOptionsLoad",function(){for(var t in e.matrix){var a=e.matrix[t];
a.order={},e.callEvent("onOptionsLoadStart",[]);for(var t=0;t<a.y_unit.length;t++)a.order[a.y_unit[t].key]=t;e.callEvent("onOptionsLoadFinal",[]),e._date&&a.name==e._mode&&e.setCurrentView(e._date,e._mode)}}),e.attachEvent("onSchedulerResize",function(){if(e.matrix[this._mode]){var t=e.matrix[this._mode];return e._renderMatrix.call(t,!0,!0),!1}return!0}),e.attachEvent("onBeforeDrag",function(t,a,n){if("resize"==a){var i=n.target||n.srcElement;e._drag_from_start=(i.className||"").indexOf("dhx_event_resize_end")<0?!0:!1
}return!0})},e._temp_matrix_scope()});