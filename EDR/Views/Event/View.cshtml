@model EDR.Models.ViewModels.EventViewModel
@using EDR.Utilities
@using EDR.Models
@using EDR.Enums

@{
    ViewBag.Title = Model.Event.Name;
    Layout = "~/Views/Event/_EventLayout.cshtml";
}

<script type="text/javascript">
    $(document).ready(function (e) {
        //  locate each partial section
        //  if it has a URL set, load the contents into the area.

        $(".partialContents").each(function (index, item) {
            var url = $(item).data("url");
            if (url && url.length > 0) {
                $(item).load(url);
            }
        });
    });
</script>
<div class="row">
    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
        <div>
            @*<h4>
                Updates
                <a class="btn btn-warning pull-right top-right" title="Add New Picture" href="@Url.Action("PostPicture", "Event", new { id = Model.Event.Id })">
                    <span class="glyphicon glyphicon-camera" aria-hidden="true"></span>
                </a>
                <a class="btn btn-warning pull-right top-right" title="Add New Video" href="@Url.Action("PostVideo", "Event", new { id = Model.Event.Id })" style="margin-left: 5px; margin-right: 5px;">
                    <span class="glyphicon glyphicon-facetime-video" aria-hidden="true"></span>
                </a>
            </h4>
            <hr />*@
            <div class="partialContents" data-url="/Event/@Model.Event.Id/GetUpdates">
                <img src="~/Content/images/indicator.white.gif" />Loading...
            </div>
        </div>
        @*@Html.Partial("~/Views/Shared/Events/_EventUpdatesPartial.cshtml", Model.MediaUpdates)*@
        @*<div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
            <div style="max-height: 1000px; overflow-y: auto; overflow-x: hidden;">
                @Html.Partial("~/Views/Shared/_PictureListPartial.cshtml", Model.Event.Pictures.OrderByDescending(p => p.PhotoDate))
            </div>
        </div>
        <div class="col-lg-6 col-md-6 col-sm-6 col-xs-6">
            <h4>
                Videos
            </h4>
            <hr />
            <div style="max-height: 1000px; overflow-y: auto; overflow-x: hidden;">
                @Html.Partial("~/Views/Shared/_VideoListPartial.cshtml", Model.Event.Videos.OrderByDescending(p => p.PublishDate))
            </div>
        </div>*@
    </div>
    <div class="col-lg-6 col-md-6 col-sm-12 col-xs-12">
        <div class="partialContents" data-url="/Event/@Model.Event.Id/GetRelatedEvents?eventType=@Model.EventType">
            <img src="~/Content/images/indicator.white.gif" />Loading...
        </div>
        <div class="well" style="white-space: pre-line">
            @Html.Raw(EDR.Utilities.ApplicationUtility.WithActiveLinks(Model.Event.Description))
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4>@(Model.EventType == EventType.Class ? "Students" : "Dancers")</h4>
            </div>
            <div class="panel-body">
                @Html.Partial("~/Views/Shared/Events/_EventMembersPartial.cshtml", Model.Event.EventMembers)
            </div>
        </div>
        <div class="panel panel-default">
            <div class="panel-heading">
                <h4 style="width: 100%; vertical-align: bottom;">
                    <img class="img-rounded" style="height: 20px;" src="@Url.Content("~/Content/images/facebookSmall.png")" />
                    Linked Events/Groups
                    @if (User.Identity != null && ((Model.Event is Class && Model.Class.Teachers.Where(x => x.ApplicationUser.UserName == User.Identity.Name).Count() == 1)) || (Model.Event is Social && Model.Social.Promoters.Where(x => x.ApplicationUser.UserName == User.Identity.Name).Count() == 1))
                    {
                        <a class="btn btn-info" style="float: right;" title="Link Facebook Event/Group" href="@Url.Action("AddFacebookLink", "Event", new { id = Model.Event.Id, eventType = Model.EventType })">
                            <i class="glyphicon glyphicon-plus-sign"></i>
                        </a>
                    }
                </h4>
            </div>
            <div class="panel-body">
                @foreach (var ee in Model.LinkedFacebookObjects)
                {
                    <div class="row" style="margin-top: 5px;">
                        <a class="btn btn-primary col-lg-8 col-md-8 col-lg-offset-1 col-md-offset-1" target="_blank" href="@Url.Content(ee.Url)" title="@ee.Name" style="text-align: left;">
                            <div style="white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">
                                <img class="img-rounded" style="height: 20px;" src="@Url.Content("~/Content/images/facebookSmall.png")" />
                                @ee.Name
                            </div>
                        </a>
                        @if (ee.FacebookId != Model.Event.FacebookId && (User.Identity != null && ((Model.Event is Class && Model.Class.Teachers.Where(x => x.ApplicationUser.UserName == User.Identity.Name).Count() == 1)) || (Model.Event is Social && Model.Social.Promoters.Where(x => x.ApplicationUser.UserName == User.Identity.Name).Count() == 1)))
                        {
                            <a class="btn btn-danger" href="@Url.Action("RemoveLinkedFacebookObject", "Event", new { id = ee.Id, returnUrl = Request.Url.AbsolutePath })">
                                <span class="glyphicon glyphicon-remove-circle" aria-hidden="true"></span>
                            </a>
                        }
                    </div>
                }
            </div>
        </div>
    </div>
</div>
